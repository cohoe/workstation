---
# A ConstantContact computer
#
- import_playbook: base.yml
- import_playbook: desktop.yml
- name: ctct
  hosts: all
  vars:
    - firewalld_zone: work
    - firewalld_enabled_services:
        - ssh
        - samba-client
  roles:
    - security
    - pipeline
    - rpmbuild
    - rvm
    - ctct

  tasks:
    # Log when we last ran
    - copy:
        dest: /etc/buildinfo
        content: "{{ ansible_date_time.iso8601 }}"
        mode: 0644
      become: yes
    # It seems that no matter what, the Fedora installer leaves some files
    # inappropriately labeled. This generates a bunch of SELinux alerts on
    # first proper login. This will get the filesystem back to a "sane"
    # state. Anything after this will need fixing.
    #
    # This command must be the last thing we run on the system to ensure
    # everything gets relabeled appropriately.
    # @TODO maybe fc29 fixed this?
#    - name: fix filesystem selinux labels
#      shell: restorecon -r /
#      become: yes

  vars_files:
    - ../vars/global.yml
    - ../vars/ctct.yml
