---
- name: install packages
  dnf:
    name:
      - NetworkManager-openvpn-gnome
    state: latest
  become: yes

- name: create CA certificate
  copy:
    dest: /etc/openvpn/pia-ca.crt
    src: pia-ca.crt
  become: yes

- name: create configurations
  template:
    src: piavpn.conf
    dest: "/etc/NetworkManager/system-connections/{{item.geo}}"
    owner: root
    group: root
    mode: 0600
  become: yes
  with_items:
    - geo: 'US East'
      host: "us-east"
    - geo: 'US West'
      host: "us-west"
    - geo: 'Romania'
      host: "ro"
    - geo: 'Ireland'
      host: "ireland"
    - geo: 'UK London'
      host: "uk-london"
    - geo: 'CA Toronto'
      host: "ca-toronto"
  notify: restart NetworkManager
