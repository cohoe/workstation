---
- name: "packages | install"
  dnf: name={{ item }} state=latest
  become: yes
  with_items:
    - dkms
    - VirtualBox-5.0
  when: '"virtualbox" in use_repos'

- name: "installed extentions | get"
  shell: vboxmanage list extpacks
  register: vbox_exts
  become: yes
  changed_when: false
  when: '"virtualbox" in use_repos'

- name: "extpack | download"
  get_url: url={{ ext_repo }}/{{ ext_pack }}
           path=/tmp/{{ ext_pack }}
  when: ("Oracle VM VirtualBox Extension Pack" not in {{ vbox_exts.stdout }}) and ("virtualbox" in {{ use_repos }})

#- name: "extpack | install"
#  shell: vboxmanage extpack install {{ ext_pack }}
#  become: yes
#  register: vbox_ext_result
#  failed_when: ('virtualbox' in {{ use_repos }} ) and ('Success' not in {{ vbox_ext_result.stdout }} or 'already installed' not in {{ vbox_ext_result.stderr }})
#  when: '"Oracle VM VirtualBox Extension Pack" not in vbox_exts.stdout'
