---
# Enable repo
- name: enable repo
  lineinfile:
    path: /etc/yum.repos.d/_copr_phracek-PyCharm.repo
    regexp: ^enabled
    line: enabled=1
  become: yes

# Install package
- name: install package
  dnf: name={{ pycharm_package }}
       state=latest
  become: yes

- name: figure out package version
  shell:
    cmd: rpm -qa {{ pycharm_package }} | sed 's/{{ pycharm_package }}-\([0-9]\+.[0-9]\)\(.*\)$/\1/'
    warn: false
  register: pycharm_package_version
  changed_when: false

- name: set the pycharm config dir
  set_fact:
    pycharm_config_dir: "{{ pycharm_config_prefix }}{{ pycharm_package_version.stdout }}"

- name: create configuration dir
  file: path=~/{{ pycharm_config_dir }}/{{ item }}
        state=directory
        recurse=yes
  with_items:
    - config/settingsRepository/repository
    - config/options

# In order for this to take effect, on first pycharm run you gotta
# do an initial overrite local settings. Not sure why, but it got me what I wanted.
- name: load config repository
  git: repo={{ pycharm_config_repo }}
       dest=~/{{ pycharm_config_dir }}/config/settingsRepository/repository

- name: switch config repo to ssh
  shell: "{{ user_bin_dir }}/git-switch-remote -r ~/{{ pycharm_config_dir }}/config/settingsRepository/repository"
