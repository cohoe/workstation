---
- name: "virtualbox | repository | create"
  yum_repository:
    name: virtualbox
    description: Fedora $releasever - $basearch - VirtualBox
    baseurl: http://download.virtualbox.org/virtualbox/rpm/fedora/$releasever/$basearch
    enabled: yes
    gpgcheck: yes
    gpgkey: https://www.virtualbox.org/download/oracle_vbox.asc
  become: yes

- name: "packages | install"
  dnf: name={{ item }} state=latest
  become: yes
  with_items:
    - VirtualBox-5.1

- name: "extpack | installer | install"
  copy: src=vbox-installext
        dest=/usr/local/sbin/vbox-installext
        mode=0775
  become: yes

- name: "extpack | installer | run"
  shell: /usr/local/sbin/vbox-installext
  register: vboxext_install
  failed_when: "vboxext_install.rc != 0"

# Needed for USB attachment
- name: "user group | add"
  user: name={{ ansible_env.USER }} append=yes
        groups=vboxusers
  become: yes
